"$schema" = "https://yazi-rs.github.io/schemas/yazi.json"

[mgr]
ratio          = [ 2, 4, 3 ]
sort_by        = "natural"
sort_sensitive = false
sort_dir_first = true
linemode       = "size_mtime_perm"
show_hidden    = true
show_symlink   = true


[log]
enabled = true
level = "debug"  # Or "trace" for more detailed logs
file = "yazi.log"

[preview]
tab_size       = 2
max_width      = 1200
max_height     = 1000
image_filter   = "triangle"
image_quality  = 75
svg_precision  = 2
# sixel_fraction was removed in v26 - it's now automatic

[opener]
edit = [
    { run = '${EDITOR:=code} "$@"', desc = "VS Code", for = "macos" },
	{ run = 'code %*',    orphan = true, desc = "code",           for = "windows" },
	{ run = 'code -w %*', block = true,  desc = "code (block)",   for = "windows" },
    { run = '${EDITOR:=kate} "$@"', desc = "KDE kate", block = true, orphan = false, for = "linux" },
]
open = [
	{ run = 'xdg-open "$1"',                desc = "Open", for = "linux" },
	{ run = 'open "$@"',                    desc = "Open", for = "macos" },
	{ run = 'start "" "%1"', orphan = true, desc = "Open", for = "windows" },
]

[open]
rules = [
    { name = "*/", use = [ "edit", "reveal" ] },
    { mime = "text/*", use = [ "edit" ] },
    { name = "*", use = [ "open" ] },
]

[plugin]
# USE PREPEND instead of fetchers to avoid breaking directory logic

# prepend_preloaders = [
#     { url = "*.svg", run = "image" },
#     { mime = "image/svg+xml", run = "image" },
# ]

prepend_previewers = [
    # { url = "*.svg", run = "image", prio="high" },
    # { mime = "image/svg+xml", run = "image" },

	{ url = "*.md", run = 'piper -- CLICOLOR_FORCE=1 glow -w=$w -s=dark "$1"' },
    # { url = "*.md", run = "rich-preview" },   # also looks good

    { url = "*.rst", run = "rich-preview"}, # for restructured text (.rst) files
    { url = "*.ipynb", run = "rich-preview"}, # looks good
	{ url = "*.js", run = 'piper -- bat --color=always --style=numbers "$1"' },

	{ url = "*.json", run = "nbpreview" }, # looks better than rich

    { url = "*.csv", run = "duckdb" },
    { url = "*.tsv", run = "duckdb" },
    { url = "*.parquet", run = "duckdb" },
    { url = "*.db", run = "duckdb" },
    { url = "*.sqlite", run = "duckdb" },
    { url = "*.duckdb", run = "duckdb" },

    { url = "*.xlsx", run = "duckdb" },
    { url = "*.docx", run = "office" },
    { url = "*.pptx", run = "office" },
    { url = "*.ods", run = "office" },
    { mime = "video/*", run = "video" },
]

# This ensures extra metadata shows up in the right-hand pane
# prepend_spotters = [
#     { mime = "{image,video,audio}/*", run = "file-extra-metadata" },
# ]

prepend_fetchers = [
    # run on files AND directories
    { id = "mactag", url = "*", run = "mactag",prio="low", },
    { id = "mactag", url = "*/", run = "mactag",prio="low", },
]

[tasks]
# Increase the number of concurrent workers for image preloading
micro_workers    = 10
macro_workers    = 15
# Ensure SVGs don't get 'skipped' if they take more than a second to render
suppress_preload = false

# preloaders = [
# 	# Image
# 	{ mime = "image/{heic,jxl,svg+xml}", run = "magick" },
# 	{ mime = "image/*", run = "image" },
# 	# Video
# 	{ mime = "video/*", run = "video" },
# 	# PDF
# 	{ mime = "application/pdf", run = "pdf" },
# 	# Font
# 	{ mime = "font/*", run = "font" },
# 	{ mime = "application/vnd.ms-opentype", run = "font" },
# ]
# previewers = [
# 	{ name = "*/", run = "folder", sync = true },
# 	# Code
# 	{ mime = "text/*", run = "code" },
# 	{ mime = "*/{xml,javascript,x-wine-extension-ini}", run = "code" },
# 	# JSON
# 	{ mime = "application/{json,x-ndjson}", run = "json" },
# 	# Image
# 	{ mime = "image/{heic,jxl,svg+xml}", run = "magick" },
# 	{ mime = "image/*", run = "image" },
# 	# Video
# 	{ mime = "video/*", run = "video" },
# 	# PDF
# 	{ mime = "application/pdf", run = "pdf" },
# 	# Archive
# 	{ mime = "application/*zip",            run = "ouch" },
# 	{ mime = "application/x-tar",           run = "ouch" },
# 	{ mime = "application/x-bzip2",         run = "ouch" },
# 	{ mime = "application/x-7z-compressed", run = "ouch" },
# 	{ mime = "application/x-rar",           run = "ouch" },
# 	{ mime = "application/vnd.rar",         run = "ouch" },
# 	{ mime = "application/x-xz",            run = "ouch" },
# 	{ mime = "application/xz",              run = "ouch" },
# 	{ mime = "application/x-zstd",          run = "ouch" },
# 	{ mime = "application/zstd",            run = "ouch" },
# 	{ mime = "application/java-archive",    run = "ouch" },

# 	# { mime = "application/{,g}zip", run = "archive" },
# 	# { mime = "application/x-{tar,bzip*,7z-compressed,xz,rar}", run = "archive" },
# 	# Font
# 	{ mime = "font/*", run = "font" },
# 	{ mime = "application/vnd.ms-opentype", run = "font" },
# 	# Fallback

# 	{ name = "*", run = "file" },
# ]
